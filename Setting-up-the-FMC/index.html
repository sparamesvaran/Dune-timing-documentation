
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="canonical" href="https://sparamesvaran.github.io/Dune-timing-documentation/Setting-up-the-FMC/">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.2.8">
    
    
      
        <title>Setting up the FMC - DUNE Timing documentation.</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.cb6bc1d0.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.39b8e14a.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="indigo">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#pre-requisites" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://sparamesvaran.github.io/Dune-timing-documentation" title="DUNE Timing documentation." class="md-header-nav__button md-logo" aria-label="DUNE Timing documentation.">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      <div class="md-header-nav__ellipsis">
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            DUNE Timing documentation.
          </span>
        </div>
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            
              Setting up the FMC
            
          </span>
        </div>
      </div>
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/sparamesvaran/Dune-timing-documentation" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    DUNE-Timing
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href=".." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  
    
  


  <li class="md-tabs__item">
    <a href="./" class="md-tabs__link md-tabs__link--active">
      Setting up the FMC
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../TimingBoardSoftware/" class="md-tabs__link">
      TimingBoardSoftware
    </a>
  </li>

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://sparamesvaran.github.io/Dune-timing-documentation" title="DUNE Timing documentation." class="md-nav__button md-logo" aria-label="DUNE Timing documentation.">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    DUNE Timing documentation.
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/sparamesvaran/Dune-timing-documentation" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    DUNE-Timing
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Setting up the FMC
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Setting up the FMC
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pre-requisites" class="md-nav__link">
    Pre-requisites:
  </a>
  
    <nav class="md-nav" aria-label="Pre-requisites:">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hardware" class="md-nav__link">
    Hardware:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#software" class="md-nav__link">
    Software:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#firmware" class="md-nav__link">
    Firmware
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup-the-connections-file" class="md-nav__link">
    Setup the connections file
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuring-the-fmc-for-operation-at-625mhz" class="md-nav__link">
    Configuring the FMC for operation at 62.5MHz
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuring-the-endpoint" class="md-nav__link">
    Configuring the endpoint
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../TimingBoardSoftware/" class="md-nav__link">
        TimingBoardSoftware
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Setting up the FMC</h1>
                
                <p>To enable testing and commissioning of the timing system, a timing FPGA mezzanine card(FMC) was designed and fabricated.  The FMC has SFP, Ethernet,  and  U.FL  connectors,  and  can  act  as  either  as  a  timing  master  or endpoint, depending on the firmware uploaded onto the carrier board FPGA. The carrier board can be either an Enclustra PX3/AX3 or a Digilent Nexsys Video card. There are different firmware images produced depending on which baseboard you have. </p>
<p>The following instructions will allow you to set up and control the timing FMC. </p>
<h2 id="pre-requisites">Pre-requisites:<a class="headerlink" href="#pre-requisites" title="Permanent link">&para;</a></h2>
<h3 id="hardware">Hardware:<a class="headerlink" href="#hardware" title="Permanent link">&para;</a></h3>
<ul>
<li>Timing FMC hosted on an Enclustra Mars PM3  base  board  with  an  Enclustra  Mars  AX3  FPGA  module or Digilent Nexsys Video card</li>
<li>JTAG  cable</li>
<li>Linux machine (for control and firmware uploads) running CentOS 8 (though CentOS 7 still currently supported)</li>
</ul>
<h3 id="software">Software:<a class="headerlink" href="#software" title="Permanent link">&para;</a></h3>
<p>The DUNE timing butler (dtsbutler) is a python-based command line tool which provides the functionality to control the timing FMC.
The dtsbutler along with the timing software backend is part of the DUNE DAQ installation. In terms of which DAQ release to use, the following
twiki page lists the most recent tags; in general the most recent tag here is the one to use. The release will begin with the text 'dunedaq-vX.X.X'.</p>
<p>https://github.com/DUNE-DAQ/daq-release/tags</p>
<p>To install this release you can find the instructions listed here. </p>
<p>https://github.com/DUNE-DAQ/daqconf/wiki</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>You will need access to CVMFS to follow the above instructions. </p>
</div>
<h3 id="firmware">Firmware<a class="headerlink" href="#firmware" title="Permanent link">&para;</a></h3>
<p>Download the firmware bit file for the FMC which will allow the FMC to behave as a master timing unit - remember to download the file which corresponds to the baseboard you have. The file below corresponds to the Enclustra baseboard, which is the default and therefore is not specified in the title of the file. The file for the Nexsys baseboard is listed next. The below is an example only - please contact the Timing development team via the #timing-integration Slack channel on the DUNE workspace to check which version of the firmware to use. If you wish to use the endpoint as the Master to issue commands, the master firmware bitfile is the one to use. </p>
<div class="highlight"><pre><span></span><code>wget https://pdts-fw.web.cern.ch/pdts-fw/ci/tags/v7.0.0/pipeline4610440/package/master_pc053d_v7-0-0_sha-3c684fa7_runner-slu9p8x4-project-19909-concurrent-0_221012_1128.tgz
</code></pre></div>
<div class="highlight"><pre><span></span><code>wget https://pdts-fw.web.cern.ch/pdts-fw/ci/tags/v6.2.0/pipeline3416367/ouroboros_pc053d_nexys_video_v6-2-0_sha-91dc3cf5_runner-slu9p8x4-project-19909-concurrent-13_220106_1707.tgz
</code></pre></div>
<p>Untar the directory and there will be a list of files including the relevant bit files.
Using Vivado or an alternative method, connect to the JTAG chain and program the FPGA with this firmware bit file. </p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Unless a specific IP address has been programmed on the FMC, RARP will be used to assign an IP address, i.e. the firwmare will use the Ethers file on the PC to assign IP addresses. You must edit this file to assign the MAC address of the baseboard (coming from the baseboard UID) to the IP you wish to assign it to. If you do not have RARP installed then you have to specify the IP via the COM port that the board is plugged into.</p>
</div>
<h2 id="setup-the-connections-file">Setup the connections file<a class="headerlink" href="#setup-the-connections-file" title="Permanent link">&para;</a></h2>
<p>A local connections file is the simplest method to ensure you connect to the correct board. A template of this file is listed here, called connections.xml</p>
<p>```</p>
<div class="highlight"><pre><span></span><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;

&lt;connections&gt;
&lt;connection id=&quot;PRIMARY&quot;             uri=&quot;ipbusudp-2.0://192.168.200.16:50001&quot; address_table=&quot;file://${TIMING_SHARE}/config/etc/addrtab/v7xx/master_fmc/top.xml&quot; /&gt;
&lt;/connections&gt;
</code></pre></div>
<p>```</p>
<p>You can use the above template, but you will need to edit the file to point to the IP address assigned to the board. In addition the address table location has to point to the correct address table for the firmware you are using. The address table can be supplied by the timing development team when they instruct which firmware to use. </p>
<h2 id="configuring-the-fmc-for-operation-at-625mhz">Configuring the FMC for operation at 62.5MHz<a class="headerlink" href="#configuring-the-fmc-for-operation-at-625mhz" title="Permanent link">&para;</a></h2>
<p>Reset the FMC with a 62.5 MHz clock file; this will output the clock. The PRIMARY in the command below has to be specified in your connections file, these DEVICE IDs have to match. </p>
<div class="highlight"><pre><span></span><code>dtsbutler -c connections.xml io PRIMARY reset  
</code></pre></div>
<details class="info"><summary>Info</summary><p>``` python
Created device PRIMARY
Design 'master' on board 'pc069' on carrier 'nexus-video' with frequency 62.5 MHz
Resetting PRIMARY
2023-Jun-07 14:49:11,171 LOG [dunedaq::timing::FMCIONode::reset(...) at /users/wx21978/projects/timing/daq_4.0.0/sourcecode/timing/src/FMCIONode.cpp:85] PLL configuration file : /home/wx21978/projects/timing/temp/pc069_clock_file.txt
2023-Jun-07 14:49:13,570 LOG [dunedaq::timing::FMCIONode::reset(...) at /users/wx21978/projects/timing/daq_4.0.0/sourcecode/timing/src/FMCIONode.cpp:118] Reset done
----------------Hardware info----------------
+--------------------------+----------------+
|        Board type        |      pc069     |
|      Board revision      |     pc069a     |
|         Board UID        | 0x803428749c04 |
|       Carrier type       |   nexus-video  |
|        Design type       |     master     |
| Firmware frequency [MHz] |    62.500000   |
+--------------------------+----------------+</p>
<p>------FMC IO state-----
+-------------+-------+
|   Register  | Value |
+-------------+-------+
|   cdr_lol   |  0x0  |
|   cdr_los   |  0x0  |
|   mmcm_ok   |  0x1  |
| mmcm_sticky |  0x0  |
|   sfp_flt   |  0x0  |
|   sfp_los   |  0x1  |
+-------------+-------+</p>
<p>PLL Clock frequency measurement:
PLL freq: 250.002006528
CDR freq: 0
SMPL freq: 0</p>
<p>PLL configuration id   : 069a_mst
-------PLL information------
+-----------------+--------+
|     Register    |  Value |
+-----------------+--------+
|   Device grade  |   0x0  |
| Device revision |   0x0  |
|   Part number   | 0x5395 |
+-----------------+--------+</p>
<p>----------PLL state----------
+-------------------+-------+
|      Register     | Value |
+-------------------+-------+
|      CAL_PLL      |  0x0  |
|        HOLD       |  0x1  |
|        LOL        |  0x1  |
|        LOS        |  0x0  |
|      LOSXAXB      |  0x0  |
|    LOSXAXB_FLG    |  0x1  |
|        OOF        |  0x0  |
|    OOF (sticky)   |  0xf  |
|   SMBUS_TIMEOUT   |  0x0  |
| SMBUS_TIMEOUT_FLG |  0x0  |
|      SYSINCAL     |  0x0  |
|    SYSINCAL_FLG   |  0x1  |
|      XAXB_ERR     |  0x0  |
|    XAXB_ERR_FLG   |  0x1  |
+-------------------+-------+</p>
</details>
<p>```</p>
<p>Set the time of the FMC master block:</p>
<div class="highlight"><pre><span></span><code>dtsbutler -c connections.xml mst PRIMARY synctime
</code></pre></div>
<details class="info"><summary>Info</summary><div class="highlight"><pre><span></span><code>    <span class="n">Created</span> <span class="n">device</span> <span class="n">PRIMARY</span>
<span class="n">Design</span> <span class="s1">&#39;master&#39;</span> <span class="n">on</span> <span class="n">board</span> <span class="s1">&#39;pc069&#39;</span> <span class="n">on</span> <span class="n">carrier</span> <span class="s1">&#39;nexus-video&#39;</span> <span class="k">with</span> <span class="n">frequency</span> <span class="mf">62.5</span> <span class="n">MHz</span>
<span class="o">----------------</span><span class="n">Hardware</span> <span class="n">info</span><span class="o">----------------</span>
<span class="o">+--------------------------+----------------+</span>
<span class="o">|</span>        <span class="n">Board</span> <span class="nb">type</span>        <span class="o">|</span>      <span class="n">pc069</span>     <span class="o">|</span>
<span class="o">|</span>      <span class="n">Board</span> <span class="n">revision</span>      <span class="o">|</span>     <span class="n">pc069a</span>     <span class="o">|</span>
<span class="o">|</span>         <span class="n">Board</span> <span class="n">UID</span>        <span class="o">|</span> <span class="mh">0x803428749c04</span> <span class="o">|</span>
<span class="o">|</span>       <span class="n">Carrier</span> <span class="nb">type</span>       <span class="o">|</span>   <span class="n">nexus</span><span class="o">-</span><span class="n">video</span>  <span class="o">|</span>
<span class="o">|</span>        <span class="n">Design</span> <span class="nb">type</span>       <span class="o">|</span>     <span class="n">master</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">Firmware</span> <span class="n">frequency</span> <span class="p">[</span><span class="n">MHz</span><span class="p">]</span> <span class="o">|</span>    <span class="mf">62.500000</span>   <span class="o">|</span>
<span class="o">+--------------------------+----------------+</span>

<span class="n">Master</span> <span class="n">FW</span> <span class="n">rev</span><span class="p">:</span> <span class="n">v7</span><span class="o">.</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">channels</span><span class="p">:</span> <span class="mi">5</span>
<span class="mi">2023</span><span class="o">-</span><span class="n">Jun</span><span class="o">-</span><span class="mi">08</span> <span class="mi">11</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mi">18</span><span class="p">,</span><span class="mi">205</span> <span class="n">LOG</span> <span class="p">[</span><span class="n">dunedaq</span><span class="p">::</span><span class="n">timing</span><span class="p">::</span><span class="n">MasterNode</span><span class="p">::</span><span class="n">sync_timestamp</span><span class="p">(</span><span class="o">...</span><span class="p">)</span> <span class="n">at</span> <span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">wx21978</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">timing</span><span class="o">/</span><span class="n">daq_4</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="n">sourcecode</span><span class="o">/</span><span class="n">timing</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">MasterNode</span><span class="o">.</span><span class="n">cpp</span><span class="p">:</span><span class="mi">295</span><span class="p">]</span> <span class="n">Reading</span> <span class="n">old</span> <span class="n">timestamp</span><span class="p">:</span> <span class="mh">0x9c4b92cd</span><span class="p">,</span> <span class="n">Thu</span><span class="p">,</span> <span class="mi">01</span> <span class="n">Jan</span> <span class="mi">1970</span> <span class="mi">01</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">41</span> <span class="o">+</span><span class="mi">0000</span>
<span class="mi">2023</span><span class="o">-</span><span class="n">Jun</span><span class="o">-</span><span class="mi">08</span> <span class="mi">11</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mi">18</span><span class="p">,</span><span class="mi">207</span> <span class="n">LOG</span> <span class="p">[</span><span class="n">dunedaq</span><span class="p">::</span><span class="n">timing</span><span class="p">::</span><span class="n">MasterNode</span><span class="p">::</span><span class="n">sync_timestamp</span><span class="p">(</span><span class="o">...</span><span class="p">)</span> <span class="n">at</span> <span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">wx21978</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">timing</span><span class="o">/</span><span class="n">daq_4</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="n">sourcecode</span><span class="o">/</span><span class="n">timing</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">MasterNode</span><span class="o">.</span><span class="n">cpp</span><span class="p">:</span><span class="mi">298</span><span class="p">]</span> <span class="n">Setting</span> <span class="n">new</span> <span class="n">timestamp</span><span class="p">:</span> <span class="mh">0x1766a8929416240</span><span class="p">,</span> <span class="n">Thu</span><span class="p">,</span> <span class="mi">08</span> <span class="n">Jun</span> <span class="mi">2023</span> <span class="mi">11</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mi">18</span> <span class="o">+</span><span class="mi">0000</span>
<span class="mi">2023</span><span class="o">-</span><span class="n">Jun</span><span class="o">-</span><span class="mi">08</span> <span class="mi">11</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mi">18</span><span class="p">,</span><span class="mi">207</span> <span class="n">LOG</span> <span class="p">[</span><span class="n">dunedaq</span><span class="p">::</span><span class="n">timing</span><span class="p">::</span><span class="n">MasterNode</span><span class="p">::</span><span class="n">sync_timestamp</span><span class="p">(</span><span class="o">...</span><span class="p">)</span> <span class="n">at</span> <span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">wx21978</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">timing</span><span class="o">/</span><span class="n">daq_4</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="n">sourcecode</span><span class="o">/</span><span class="n">timing</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">MasterNode</span><span class="o">.</span><span class="n">cpp</span><span class="p">:</span><span class="mi">303</span><span class="p">]</span> <span class="n">Reading</span> <span class="n">new</span> <span class="n">timestamp</span><span class="p">:</span> <span class="mh">0x1766a8929416e22</span><span class="p">,</span> <span class="n">Thu</span><span class="p">,</span> <span class="mi">08</span> <span class="n">Jun</span> <span class="mi">2023</span> <span class="mi">11</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mi">18</span> <span class="o">+</span><span class="mi">0000</span>
<span class="mi">2023</span><span class="o">-</span><span class="n">Jun</span><span class="o">-</span><span class="mi">08</span> <span class="mi">11</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mi">18</span><span class="p">,</span><span class="mi">207</span> <span class="n">LOG</span> <span class="p">[</span><span class="n">dunedaq</span><span class="p">::</span><span class="n">timing</span><span class="p">::</span><span class="n">MasterNode</span><span class="p">::</span><span class="n">sync_timestamp</span><span class="p">(</span><span class="o">...</span><span class="p">)</span> <span class="n">at</span> <span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">wx21978</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">timing</span><span class="o">/</span><span class="n">daq_4</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="n">sourcecode</span><span class="o">/</span><span class="n">timing</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">MasterNode</span><span class="o">.</span><span class="n">cpp</span><span class="p">:</span><span class="mi">306</span><span class="p">]</span> <span class="n">Timestamp</span> <span class="n">broadcast</span> <span class="n">enabled</span>
</code></pre></div>
</details>
<p>Check status of timing master - - the TimeSync cnts number in the final table below shows the number of pulses sent.</p>
<div class="highlight"><pre><span></span><code>```
</code></pre></div>
<p>dtsbutler -c connections.xml mst PRIMARY status </p>
<div class="highlight"><pre><span></span><code>```

??? info 
    ``` python
    Design &#39;master&#39; on board &#39;pc069&#39; on carrier &#39;nexus-video&#39; with frequency 62.5 MHz
----------------Hardware info----------------
+--------------------------+----------------+
|        Board type        |      pc069     |
|      Board revision      |     pc069a     |
|         Board UID        | 0x803428749c04 |
|       Carrier type       |   nexus-video  |
|        Design type       |     master     |
| Firmware frequency [MHz] |    62.500000   |
+--------------------------+----------------+

Master FW rev: v7.0.0, channels: 5
Timestamp: 0x1766a893ba5014a -&gt; Thu, 08 Jun 2023 11:34:22 +0000

Master global controls
+------------+-------+
|  Register  | Value |
+------------+-------+
|  clr_ctrs  |  0x0  |
|   resync   |  0x0  |
| resync_cdr |  0x0  |
|    ts_en   |  0x1  |
+------------+-------+
--Master global state-
+------------+-------+
|  Register  | Value |
+------------+-------+
| cdr_locked |  0x0  |
|  ctrs_rdy  |  0x1  |
|   rx_rdy   |  0x0  |
|   ts_err   |  0x0  |
|   tx_err   |  0x0  |
+------------+-------+

--------------Cmd gen counters--------------
+------+-----------------+-----------------+
|      | Accept counters | Reject counters |
+------+-----------------+-----------------+
| Chan |  cnts  |   hex  |  cnts  |   hex  |
+------+--------+--------+--------+--------+
|  0x0 |    0   |   0x0  |    0   |   0x0  |
|  0x1 |    0   |   0x0  |    0   |   0x0  |
|  0x2 |    0   |   0x0  |    0   |   0x0  |
|  0x3 |    0   |   0x0  |    0   |   0x0  |
|  0x4 |    0   |   0x0  |    0   |   0x0  |
+------+--------+--------+--------+--------+

--Master cmd counters (&gt;0)-
+-----+-------------------+
|     | Sent cmd counters |
+-----+-------------------+
| Cmd |   cnts  |   hex   |
+-----+---------+---------+
| 0x0 |    4    |   0x4   |
+-----+---------+---------+

-Master acmd buffer-
+----------+-------+
| Register | Value |
+----------+-------+
|   ready  |  0x1  |
|  timeout |  0x0  |
+----------+-------+
```
</code></pre></div>
<h2 id="configuring-the-endpoint">Configuring the endpoint<a class="headerlink" href="#configuring-the-endpoint" title="Permanent link">&para;</a></h2>
<p>First reset the Endpoint:</p>
<div class="highlight"><pre><span></span><code>dtsbutler -c connections.xml io $EPT reset
</code></pre></div>
<p>Enable the address you wish to, in this example we enable address 0x2. This will put the endpoint into status 0x6 (WAITING FOR DELAYS).</p>
<div class="highlight"><pre><span></span><code>dtsbutler -c connections.xml ept ${EPT} enable -a 2
</code></pre></div>
<p>Apply the timing delays, the first digit is the address, the second and third are coarse and fine delay parameters.</p>
<div class="highlight"><pre><span></span><code>dtsbutler -c connections.xml mst ${MST} align apply-delay 2 0 0
</code></pre></div>
<p>Check the status of the endpoint.</p>
<div class="highlight"><pre><span></span><code>dtsbutler -c connections.xml ept ${EPT} status
</code></pre></div>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href=".." class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Home
              </div>
            </div>
          </a>
        
        
          <a href="../TimingBoardSoftware/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                TimingBoardSoftware
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.18f0862e.min.js"></script>
      <script src="../assets/javascripts/bundle.994580cf.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: ['toc.integrate', 'navigation.sections', 'navigation.tabs'],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.9c0e82ba.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>