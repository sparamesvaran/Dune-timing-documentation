
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="canonical" href="https://dune-timing.github.io/versions/v1.0.0/Step-by-step-instructions-for-creating-your-own-DAQModule-package/">
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.2.8">
    
    
      
        <title>Introduction - DUNE Timing documentation.</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.cb6bc1d0.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.39b8e14a.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#introduction" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://dune-timing.github.io/" title="DUNE Timing documentation." class="md-header-nav__button md-logo" aria-label="DUNE Timing documentation.">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      <div class="md-header-nav__ellipsis">
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            DUNE Timing documentation.
          </span>
        </div>
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            
              Introduction
            
          </span>
        </div>
      </div>
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/sparamesvarab/Dune-timing-documentation" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    DUNE-Timing
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://dune-timing.github.io/" title="DUNE Timing documentation." class="md-nav__button md-logo" aria-label="DUNE Timing documentation.">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    DUNE Timing documentation.
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/sparamesvarab/Dune-timing-documentation" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    DUNE-Timing
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../FMCtesting/" class="md-nav__link">
        FMCtesting
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../Glossary-of-Terms/" class="md-nav__link">
        Glossary of Terms
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../Timing-Board-Software/" class="md-nav__link">
        Developer's Guide
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
      
      <label class="md-nav__link" for="nav-5">
        Versions
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Versions" data-md-level="1">
        <label class="md-nav__title" for="nav-5">
          <span class="md-nav__icon md-icon"></span>
          Versions
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5-1" type="checkbox" id="nav-5-1" >
      
      <label class="md-nav__link" for="nav-5-1">
        Devel
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Devel" data-md-level="2">
        <label class="md-nav__title" for="nav-5-1">
          <span class="md-nav__icon md-icon"></span>
          Devel
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../devel/Compiling-and-running/" class="md-nav__link">
        Compiling and running
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../devel/Creating-a-new-package/" class="md-nav__link">
        Creating a new package
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../devel/Step-by-step-instructions-for-creating-your-own-DAQModule-package/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../devel/Testing/" class="md-nav__link">
        Testing
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5-2" type="checkbox" id="nav-5-2" checked>
      
      <label class="md-nav__link" for="nav-5-2">
        V1.0.0
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="V1.0.0" data-md-level="2">
        <label class="md-nav__title" for="nav-5-2">
          <span class="md-nav__icon md-icon"></span>
          V1.0.0
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Compiling-and-running/" class="md-nav__link">
        Compiling and running
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Creating-a-new-package/" class="md-nav__link">
        Creating a new package
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Introduction
      </a>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Testing/" class="md-nav__link">
        Testing
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5-3" type="checkbox" id="nav-5-3" >
      
      <label class="md-nav__link" for="nav-5-3">
        V1.1.0
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="V1.1.0" data-md-level="2">
        <label class="md-nav__title" for="nav-5-3">
          <span class="md-nav__icon md-icon"></span>
          V1.1.0
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../v1.1.0/Compiling-and-running/" class="md-nav__link">
        Compiling and running
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../v1.1.0/Creating-a-new-package/" class="md-nav__link">
        Creating a new package
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../v1.1.0/Step-by-step-instructions-for-creating-your-own-DAQModule-package/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../v1.1.0/Testing/" class="md-nav__link">
        Testing
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="introduction">Introduction</h1>
<p>This page is intended to provide a step-by-step guide to setting up a work area in which you create software <em>modules</em> that run within Version 1 of the DUNE DAQ software application framework (<em>appfwk</em> v1). These modules are often called <em>DAQModules</em> since that is the C++ base class that they inherit from. If you are impatient to get started, you can jump to the [[Step-by-step Instructions|Step-by-step-instructions-for-creating-your-own-DAQModule-package-under-v1#step-by-step Installation instructions]] now.<br />
New users should probably continue reading this introduction, though, to learn a little bit of background information.</p>
<p>This page draws from, and references, several other Wiki pages in the <em>appfwk</em> repository.  Links to these pages are listed in the text in the relevant places, and they are a good source of additional information for interested readers.  Here are some of these references collected for you in one place on this page:
* [[Compiling and running the App Fwk|Compiling-and-running]]
* [[Creating a new package|Creating-a-new-package]]</p>
<p>and last, but certainly not least
* <a href="https://github.com/DUNE-DAQ/styleguide/blob/develop/dune-daq-cppguide.md">The DUNE DAQ C++ Style Guide</a></p>
<p>This page assumes a basic understanding of how modules are combined to form processes within <em>appfwk</em> v1.<br />
A brief recap can be found in the following snippet. </p>
<details> 
A reference for this is the <a href="https://indico.fnal.gov/event/43856/contributions/188824/attachments/129646/157355/Sneak_peek_into_the_application_framework.pdf"> sneak peak talk </a> given by Eric Flumerfelt on 15-Jun-2020.  

As a refresher:
* a *DAQProcess* contains one or more *DAQModules*
* when multiple *DAQModules* are present within a *DAQProcess*, they communicate with each other via *Queues* (the diagrams that are included [[later on this page|Step-by-step-instructions-for-creating-your-own-DAQModule-package-under-v1#information-about-the-daqmodules-in-the-listrev-example]] might help explain this)
* there are two classes that wrap *Queues* to provide the ability to push data onto the queue (*DAQSink*) or pull data from a queue (*DAQSource*). An individual *DAQModule* will only access one side of each *Queue*.  If the module pushes data onto the queue, it will use an instance of the *DAQSink* class (which wraps the desired *Queue*), and if the module pops data from the queue, it will use an instance of the *DAQSource* class.
* the *DAQModules* that run within a given process (and the *Queues* between them) are specified in a JSON *process configuration* file.  An example of one such file is given below.  The creation of the *DAQModules* and *Queues* is handled by the *appfwk*.
* at this point in time, we expect that most users will be developing *DAQModules* and simply using existing *Queues* from the *appfwk*.  
* at the moment, there aren't any centrally-provided libraries, tools, or recommendations for inter-process communication.  We expect to address this topic soon, but for now, developers can either focus on single-process examples, or use other software for inter-process communication.  The instructions on this page focus on single-process examples.
* please remember that there have been a number of compromises or simplifications in the functionality that is provided by *appfwk* v1.  We have made a good faith attempt to provide a good start on the internal interfaces and layout of *DAQProcesses*, but things will definitely change over time, and we will be gathering feedback from everyone on ways that things might be improved.  (Of course, we already have a fairly good list based on the experience of creating v1.)

</details>

<h1 id="step-by-step-installation-instructions">Step-by-step Installation instructions</h1>
<p>Here are the suggested steps for setting up a work area, in which you can create your new package:</p>
<ul>
<li>Choose a computer/cluster to work on that has access to <code>/cvmfs/dune.opensciencegrid.org/dunedaq/DUNE/products</code> (more details on compiling and running code with the <em>appfwk</em> are provided on the [[Compiling and Running|Compiling-and-running#if-you-have-access-to-cvmfs-ups-product-areas]] page)</li>
<li>this CVMFS area is where several necessary dependent software packages are stored (for now)</li>
<li><code>lxplus.cern.ch</code> has been used successfully for this purpose</li>
<li>Log into that computer/cluster, create a fresh directory to work in, and <code>cd</code> into that directory (I'll call this your <code>WORK_DIR</code>.)</li>
<li>Run the following four commands (these are based on commands from the [[Compiling and Running|Compiling-and-running#if-you-have-access-to-cvmfs-ups-product-areas]] page)</li>
<li><code>curl -O https://raw.githubusercontent.com/DUNE-DAQ/daq-buildtools/v1.0.0/bin/quick-start.sh</code></li>
<li><code>chmod +x quick-start.sh</code></li>
<li><code>sed -r -i 's/edits_check=true/edits_check=false/' quick-start.sh</code></li>
<li><code>./quick-start.sh</code>
Don't be concerned about the "User assumes the risk that the script may make out-of-date assumptions" warning you see. It's because you're not using the newest version of quick-start.sh, you're using the v1.0.0 version. After you've run <code>quick-start.sh</code> we'll account for this by making sure the downloaded repos are pointing to the v1.0.0 codebase:</li>
<li><code>for pkg in appfwk ers daq-buildtools; do cd $pkg; git checkout v1.0.0; cd .. ; done</code></li>
<li>Set up the build environment for this <code>WORK_DIR</code> by running the following command:</li>
<li><code>source ./setup_build_environment</code></li>
<li>Build the core packages that the <code>quick-start.sh</code> sript installed in your working directory by running this command:</li>
<li><code>./build_daq_software.sh</code></li>
<li>please note that you'll likely see some messages like <code>nlohmann_json NOT FOUND!</code>.  This is not a cause for alarm.  The build process automatically downloads and builds the nlohmann::json package for you, after it notices that it wasn't found.</li>
<li>there may also be a warning message about an unused variable in <code>ers/src/Issue.cxx</code>. Again, this is nothing to worry about.</li>
<li>If you would like to try running the example application(s) from the core <em>appfwk</em> repository, you can do that now.  There are instructions [[later on this page|Step-by-step-instructions-for-creating-your-own-DAQModule-package#running-the-fanout-example-in-the-appfwk-repo]] for doing that. </li>
</ul>
<p>At this point, you could either check out the example DAQModule package, build it, and run the the example application, or you could start [[creating your own package|Step-by-step-instructions-for-creating-your-own-DAQModule-package#Create-your-own-software-package]].<br />
These instructions will walk you through doing both, but of course you can skip to the latter by scrolling to the dedicated section.</p>
<h2 id="install-the-example-package">Install the example package</h2>
<p>Here are the steps for adding the <em>appfwk</em> Example package to your work area, building it, and running the example application... (For information on the <em>DAQModules</em> that are contained in the example application and how they interact, please see [[this section|Step-by-step-instructions-for-creating-your-own-DAQModule-package#Information-about-the-DAQModules-in-the-listrev-example]] later on this page.)
* <code>cd</code> into your work area directory (<code>WORK_DIR</code>), if you aren't there already
* run the following command to clone the example package:
  * <code>git clone https://github.com/DUNE-DAQ/listrev.git</code>
* ...and make sure you've got the v1.0.0 version of it
  * <code>cd listrev</code>
  * <code>git checkout v1.0.0</code>
  * <code>cd ..</code>
* add the following line to the bottom of the top-level CMakeLists.txt file (in <code>WORK_DIR</code>)
  * <code>add_subdirectory(listrev)</code>
* [if not already done in the current shell] set up the build environment for your work area
  * <code>source ./setup_build_environment</code>
* rebuild the software in your work area by running
  * <code>./build_daq_software.sh</code></p>
<p>In order to run the example package follow the instruction in the [[dedicated section|Step-by-step-instructions-for-creating-your-own-DAQModule-package-under-v1#Running the example package]].</p>
<h2 id="create-your-own-software-package">Create your own software package</h2>
<p>Here are the commands to create your own software package that depends on appfwk:
* create a new directory underneath <code>WORK_DIR</code> (we'll call this <code>YOUR_PKG_DIR</code>)
* copy the <code>CMakeLists.txt</code> file from the example package into <code>YOUR_PKG_DIR</code> (you can fetch it from <a href="https://github.com/DUNE-DAQ/listrev/blob/v1.0.0/CMakeLists.txt">here</a>)
  * edit this CMakeLists.txt file to change all of the instances of the string "listrev" to your package name
  * (we'll do a couple more edits in a bit, but you can save and close this file now
* create a <code>src</code> directory underneath <code>YOUR_PKG_DIR</code>
* copy one of the <em>DAQModules</em> from the example package into the <code>src</code> directory
  * as an example, let's copy the RandomDataListGenerator <em>DAQModule</em> from the example package, along with the CommonIssues header file.  You can fetch these files from <a href="https://github.com/DUNE-DAQ/listrev/blob/v1.0.0/src/RandomDataListGenerator.hpp">here</a>, <a href="https://github.com/DUNE-DAQ/listrev/blob/v1.0.0/src/RandomDataListGenerator.cpp">here</a>, and <a href="https://github.com/DUNE-DAQ/listrev/blob/v1.0.0/src/CommonIssues.hpp">here</a>.
  * change all instances of "listrev" and "LISTREV" in these files to your package name
* edit <code>YOUR_PKG_DIR</code>/CMakeLists.txt to remove the ListReverser and ReversedListValidator add_library and target_link_libraries lines
  * you should also comment out the <code>point_build_to( test )</code> and <code>file(COPY test/list_reversal_app.json DESTINATION test)</code> lines
* add the following line to the bottom of the top-level CMakeLists.txt file (in <code>WORK_DIR</code>)
  * <code>add_subdirectory(YOUR_PKG_DIR)</code>
* <code>cd</code> to <code>WORK_DIR</code>
* [if not already done in the current shell] set up the build environment for your work area
  * <code>source ./setup_build_environment</code>
* rebuild the software in your work area by running
  * <code>./build_daq_software.sh</code>
* at this point, you'll have a decent start on your own <em>DAQModule</em> package.  Of course, you'll need to rename and modify the <code>RandomDataListGenerator</code> <em>DAQModule</em> to do whatever you want your first <em>DAQModule</em> to do.  And, when you get the point of running your <em>DAQProcess</em> that uses your <em>DAQModule</em>(s), you'll need to create a JSON <em>process configuration</em> file to use for that, but hopefully the <em>listrev</em> example package will help.</p>
<h3 id="how-to-write-a-daqmodule">How to write a DAQModule</h3>
<p>From the C++ point of view, DAQ modules are implementation of a [[DAQ Module interface|DAQModules]]. 
That means that apart from the constructor (that receives a name) only one method has to be implemented: <code>init()</code>.<br />
The function has to handle all those configuration items that are not supposed to be reconfigurable during the run. 
Optionally it can configure all those variables that can be overridden during run time.</p>
<p>The most important thing that <code>init</code> has to do is to call <code>register_command</code> in order to associate functions to each command that the module is expected to support. 
Each function has to be a set of operations that changes the internal status of the module according to the command that it is implementing. 
The prototype of each function is in the form </p>
<pre><code class="language-C++">void do_something( const vector&lt;string&gt; &amp; args ) ;
</code></pre>
<p>The function can be virtual and the system is able to pick the most downstream specification. </p>
<p>Assuming that the name of the module you are developing is <code>MyNewDAQModule</code> a call to associate the command <code>"start"</code> to a function called <code>do_start</code> will be </p>
<pre><code class="language-C++">register_command(&quot;start&quot;,  &amp; MyNewDAQModule::do_start);
</code></pre>
<p>It is expected that the operations of the DAQ Module are carried on in other threads under the control of the DAQModule itself. </p>
<!--
## Good practices
Every piece of code that is related to the application framework will be part of a large suite of software that will require long term maintenance and support given the long lifetime of the DUNE experiment.
It is important that the [style guide](https://github.com/DUNE-DAQ/styleguide/blob/develop/dune-daq-cppguide.md) is respected.
-->

<h3 id="how-to-make-your-daqmodule-a-plugin-of-the-appfmw">How to make your DAQModule a plugin of the appfmw</h3>
<p>DAQModules need to be created with a factory pattern simply via their name.
In the application framework this is done using <a href="https://github.com/DUNE-DAQ/appfwk/wiki/Third-Party-Software">CETlib</a>. 
In order to do that, each implementation (<code>cpp</code> file) needs to have a call to the macro <code>DEFINE_DUNE_DAQ_MODULE(&lt;name_including_namespace&gt;)</code> for example</p>
<pre><code class="language-C++">DEFINE_DUNE_DAQ_MODULE(dunedaq::appfwk::DummyModule)
</code></pre>
<p>In order to generate a shared object library that is linkable in runtime from the application framework, the name of the library has to be the in the form <code>&lt;package&gt;_&lt;module_name_no_namespace&gt;_duneDAQModule</code>.
This can be achieved simply adding a line in the <code>CMakeLists.txt</code> file of your project in the form <code>add_library(&lt;package&gt;_&lt;module_name_no_namespace&gt;_duneDAQModule  path/to/my/file.cpp)</code>. 
For example:</p>
<pre><code class="language-CMake">add_library(appfwk_DummyModule_duneDAQModule test/DummyModule.cpp)
</code></pre>
<h1 id="running-examples">Running examples</h1>
<h2 id="running-the-example-package">Running the example package</h2>
<p>Assuming you installed your software as described in the previous sections, these are the instructions to run the code:
* set up the runtime environment setup script by running this command:
  * <code>source ./setup_runtime_environment</code>
  * please note that this needs to be done from <code>WORK_DIR</code>
* run the example application using the following command:
  * <code>build/appfwk/apps/daq_application -c QueryResponseCommandFacility -j build/listrev/test/list_reversal_app.json</code>
* once the program is running, and you see the "Enter a command" prompt, you can type in commands like the following:
  * <code>configure</code>
    * This command pretends to set the values of configurable parameters like the number of integers in each randomly generated list
  * <code>start</code> 
    * This command is passed to the three <em>DAQModules</em> in a well-specified order (specified in the JSON <em>process configuration</em> file).  First, the <em>validator</em> is started, then the <em>reverser</em>, then the <em>generator</em>.  Once the <em>generator</em> is started, it begins creating lists of integers and passing them to the other two <em>DAQModules</em>.
    * On the console, you will see ERS LOG messages from each of the <em>DAQModules</em> saying that they started (so you can confirm that the start order is correct), and then you will see ERS DEBUG messages that tell you what each of the <em>DAQModules</em> is doing as they process the lists of integers.
  * <code>stop</code>
    * This command stops the three <em>DAQModules</em>, in the reverse order that they were started (like the start order, the stop order is specified in the JSON <em>process config</em> file).<br />
    * You will need to type this command into the console a little blindly, since the ERS DEBUG messages will be printing to the console as the program runs.
    * After each of the three <em>DAQModules</em> has finished, they print an ERS INFO message to the console with a summary of what they accomplished.
  * <code>unconfigure</code>
    * This command pretends to tear-down whatever configuration was established in the configure step.
  * <code>quit</code>
    * This command exits the program.</p>
<h3 id="information-about-the-daqmodules-in-the-listrev-example">Information about the <em>DAQModules</em> in the <em>listrev</em> example</h3>
<p>The idea behind the <em>listrev</em> example is to have one <em>DAQModule</em> that generates a list of random integers, another <em>DAQModule</em> that reverses a copy of the list, and a third <em>DAQModule</em> that compares copies of the original and reversed lists to validate that they are equivalent, modulo the reversal.</p>
<p>This is shown in the following diagrams.  The first one provides a little description of what each of the <em>DAQModules</em> is doing, and the second one shows the class names of the <em>DAQModules</em> and the configured names of the <em>DAQModules</em> and the <em>Queues</em>, as they are identified in the JSON <em>process configuration</em> file.</p>
<p><img src="https://user-images.githubusercontent.com/36311946/85792278-d763ad80-b6f8-11ea-9668-8ab540da977b.jpg" width="500" />
<img src="https://user-images.githubusercontent.com/36311946/85792290-daf73480-b6f8-11ea-82a8-cdf712276249.jpg" width="500" /></p>
<p>A copy of the <em>listrev</em> JSON <em>process configuration</em> file is shown below (the official copy of this file in the repo is <a href="https://github.com/DUNE-DAQ/listrev/blob/master/test/list_reversal_app.json">here</a>).  As you can see, the <em>Queues</em> are specified first, then the <em>DAQModules</em>, and the <em>DAQModules</em> include the configuration of which <em>Queues</em> they make use of.
* The <code>capacity</code> and <code>kind</code> parameters within the queue declarations are required.  The names of the queues (e.g. <code>primaryDataQueue</code>) are your choice.
* The <code>user_module_type</code> parameter in the module declarations is required.  The names of the parameters that specify the queues to the modules are up to you.  As you can see in this example, different parameter names are used to specify the queues to the three different modules.  (Of course, what the <em>DAQModule</em> code does with the queue names is standardized.  An example of that is shown in <a href="https://github.com/DUNE-DAQ/listrev/blob/master/src/ReversedListValidator.cpp#L48">this snippet of listrev code</a>.)</p>
<pre><code>{
  &quot;queues&quot;: {
    &quot;primaryDataQueue&quot;: {
      &quot;capacity&quot;: 10,
      &quot;kind&quot;: &quot;FollySPSCQueue&quot;
    },
    &quot;reversedDataQueue&quot;: {
      &quot;capacity&quot;: 10,
      &quot;kind&quot;: &quot;FollySPSCQueue&quot;
    },
    &quot;dataCopyQueue&quot;: {
      &quot;capacity&quot;: 10,
      &quot;kind&quot;: &quot;FollySPSCQueue&quot;
    }
  },
  &quot;modules&quot;: {
    &quot;generator&quot;: {
      &quot;user_module_type&quot;: &quot;RandomDataListGenerator&quot;,
      &quot;outputs&quot;: [ &quot;primaryDataQueue&quot;, &quot;dataCopyQueue&quot; ]
    },
    &quot;reverser&quot;: {
      &quot;user_module_type&quot;: &quot;ListReverser&quot;,
      &quot;input&quot;: &quot;primaryDataQueue&quot;,
      &quot;output&quot;: &quot;reversedDataQueue&quot;
    },
    &quot;validator&quot;: {
      &quot;user_module_type&quot;: &quot;ReversedListValidator&quot;,
      &quot;reversed_data_input&quot;: &quot;reversedDataQueue&quot;,
      &quot;original_data_input&quot;: &quot;dataCopyQueue&quot;
    }
  },
  &quot;commands&quot;: {
    &quot;start&quot;: [ &quot;validator&quot;, &quot;reverser&quot;, &quot;generator&quot; ],
    &quot;stop&quot;: [ &quot;generator&quot;, &quot;reverser&quot;, &quot;validator&quot; ]
  }
}
</code></pre>
<p>As mentioned earlier on this page, when you run the <em>listrev</em> example, you will see ERS messages printed out in the console.  ERS is the Error Reporting Service from the ATLAS experiment. Within the DUNE DAQ, we have our own fork of that package, and you will see a clone of the DUNE DAQ ERS repo when you look at the directories underneath <code>WORK_DIR</code>. For further information on ERS, you can see <a href="https://iopscience.iop.org/article/10.1088/1742-6596/608/1/012004/pdf">this journal article (PDF)</a>.</p>
<p>In addition to ERS messages, there are TRACE messages in the <em>listrev</em> example code.  The current model for using ERS and TRACE is described in <a href="https://github.com/DUNE-DAQ/styleguide/blob/develop/dune-daq-cppguide.md#69--printing-messages-dune-version-no-google-equivalent">a section of the Style Guide</a>, and the example code follows those guidelines.  For example, the example <em>DAQModule</em>s usee ERS Issues for warnings, errors, and fatal errors, and TRACE messages for messages that developers would use for debugging or verifying the behavior of the code.  The periodic progress reports are implemented as ERS DEBUG messages, although admittedly, they could just as easily been implemented as TRACE messages.  The choice there was simply a practical one - that ERS messages are displayed on the console by default, whereas TRACE messages typically go to a memory area by default so that they use very little system resources. (TRACE messages can trivially be directed to the console, but that would have been just one more step in the instructions above.)</p>
<p>Users who are interested in seeing the TRACE messages from the <em>listrev</em> example code, or their own <em>DAQModules</em> when the time comes, can use the following steps:
* before running the program, set the TRACE_FILE environmental variable to point to a file underneath your <code>WORK_DIR</code>
  * <code>export TRACE_FILE=&lt;WORK_DIR&gt;/log/${USER}_dunedaq.trace</code>
* run the program
* look at the TRACE levels that are enabled for each TRACE_NAME (TRACE_NAMEs are used to help identify which source file the messages were sent from)
  * <code>tlvls</code>
* enable the TRACE levels that you would like to see appear in the TRACE memory buffer with commands like the following:
  * <code>tonM -n RandomDataListGenerator 10</code>
  * <code>tonM -n RandomDataListGenerator 15</code>
* view the messages in the TRACE memory buffer.  I appreciate seeing the timestamps in human-readable form, so I typically pipe the output of <code>tshow</code> to <code>tdelta</code> as shown here (both are provided by the TRACE package)
  * <code>tshow | tdelta -ct 1 | more</code>
  * Note that the messages from the TRACE buffer are displayed in reverse time order (most recent message first)</p>
<p>This short introduction to TRACE only describes a small fraction of its capabilities, and interested users are encouraged to read the Quick Start guide, the User's Guide, and other documentation provided <a href="https://cdcvs.fnal.gov/redmine/projects/trace/wiki">here</a>.</p>
<h2 id="running-the-fanout-example-in-the-appfwk-repo">Running the Fanout example in the appfwk repo</h2>
<p>In a fresh shell, here are the steps that you would use to run the Fanout example in the appfwk repo <strong>after</strong> you have run <code>quick-start.sh</code> and built the software using <code>build_daq_software.sh</code>:
* <code>cd</code> to your <code>WORK_DIR</code>
* run the following commands to set up the build and runtime environments:
  * <code>source ./setup_build_environment</code>
  * <code>source ./setup_runtime_environment</code>
* run the following command to start the example:
  * <code>build/appfwk/apps/daq_application -c QueryResponseCommandFacility -j appfwk/test/producer_consumer_dynamic_test.json</code>
* enter commands like the following:
  * <code>configure</code>
  * <code>start</code>
  * <code>stop</code>
  * <code>quit</code></p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../Creating-a-new-package/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Creating a new package
              </div>
            </div>
          </a>
        
        
          <a href="../Testing/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Testing
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/vendor.18f0862e.min.js"></script>
      <script src="../../../assets/javascripts/bundle.994580cf.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "../../..",
          features: [],
          search: Object.assign({
            worker: "../../../assets/javascripts/worker/search.9c0e82ba.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>