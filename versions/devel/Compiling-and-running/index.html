<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://dune-timing.github.io/versions/devel/Compiling-and-running/">
        <link rel="shortcut icon" href="../../../img/favicon.ico">
        <title>Compiling and running - DUNE Timing documentation.</title>
        <link href="../../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">

        <script src="../../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../../..">DUNE Timing documentation.</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../../.." class="nav-link">Home</a>
                            </li>
                            <li class="navitem">
                                <a href="../../../FMCtesting/" class="nav-link">FMCtesting</a>
                            </li>
                            <li class="navitem">
                                <a href="../../../Glossary-of-Terms/" class="nav-link">Glossary of Terms</a>
                            </li>
                            <li class="navitem">
                                <a href="../../../Timing-Board-Software/" class="nav-link">Developer's Guide</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Versions <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Devel</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="./" class="dropdown-item active">Compiling and running</a>
</li>
            
<li>
    <a href="../Creating-a-new-package/" class="dropdown-item">Creating a new package</a>
</li>
            
<li>
    <a href="../Step-by-step-instructions-for-creating-your-own-DAQModule-package/" class="dropdown-item">Introduction</a>
</li>
            
<li>
    <a href="../Testing/" class="dropdown-item">Testing</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">V1.0.0</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../v1.0.0/Compiling-and-running/" class="dropdown-item">Compiling and running</a>
</li>
            
<li>
    <a href="../../v1.0.0/Creating-a-new-package/" class="dropdown-item">Creating a new package</a>
</li>
            
<li>
    <a href="../../v1.0.0/Step-by-step-instructions-for-creating-your-own-DAQModule-package/" class="dropdown-item">Introduction</a>
</li>
            
<li>
    <a href="../../v1.0.0/Testing/" class="dropdown-item">Testing</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">V1.1.0</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../v1.1.0/Compiling-and-running/" class="dropdown-item">Compiling and running</a>
</li>
            
<li>
    <a href="../../v1.1.0/Creating-a-new-package/" class="dropdown-item">Creating a new package</a>
</li>
            
<li>
    <a href="../../v1.1.0/Step-by-step-instructions-for-creating-your-own-DAQModule-package/" class="dropdown-item">Introduction</a>
</li>
            
<li>
    <a href="../../v1.1.0/Testing/" class="dropdown-item">Testing</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../../../Timing-Board-Software/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../Creating-a-new-package/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/sparamesvarab/Dune-timing-documentation" class="nav-link">DUNE-Timing</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="2"><a href="#running" class="nav-link">Running</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#testing-and-running-inside-a-docker-container" class="nav-link">Testing and running inside a docker container</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#next-steps" class="nav-link">Next Steps</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<p>To get set up, you'll need access to the ups product area <code>/cvmfs/dune.opensciencegrid.org/dunedaq/DUNE/products</code>, as is the case, e.g., on the lxplus machines at CERN. If you're on a system which has access to this product area, simply do the following after you've logged in to your system and created an empty directory (we'll refer to it as "MyTopDir" on this wiki):</p>
<pre><code class="language-sh">curl -O https://raw.githubusercontent.com/DUNE-DAQ/daq-buildtools/develop/bin/quick-start.sh
chmod +x quick-start.sh
./quick-start.sh
</code></pre>
<p>which will install the needed repos and provide you with a file you can then source to set up the build environment, <code>setup_build_environment</code>, and an executable script you can run for builds, <code>build_daq_software.sh</code>. If, after running <code>quick-start.sh</code>, you want to build the appfwk package and install it in a local subdirectory called <code>./install</code> right away, all you need to do is the following:</p>
<pre><code>. ./setup_build_environment  # Only needs to be done once in a given shell
./build_daq_software.sh --install
</code></pre>
<p><code>build_daq_software.sh</code> will by default skip CMake's config+generate stages and go straight to the build stage <em>unless</em> the <code>CMakeCache.txt</code> file isn't found in <code>./build/appfwk</code> -- which is of course the case the first time you run it. If you want to remove all the contents of <code>./build/appfwk</code> and run config+generate+build, all you need to do is add the <code>--clean</code> option, i.e.</p>
<pre><code>./build_daq_software.sh --clean --install
</code></pre>
<p>And if, after the build, you want to run the unit tests, just add the <code>--unittest</code> option. Note that it can be used with or without <code>--clean</code>, so, e.g.:</p>
<pre><code>./build_daq_software.sh --clean --install --unittest  # Blow away the contents of ./build/appfwk, run config+generate+build, and then run the unit tests
</code></pre>
<p>..where in the above case, you blow away the contents of ./build/appfwk,  run config+generate+build, install the result in <code>./install</code> and then run the unit tests.</p>
<p>If you want to develop a package other than appfwk, you'll want to add the <code>--pkgname &lt;package name&gt;</code> option. E.g., if we want to build listrev (a simple DAQModule package written by Kurt Biery and documented elsewhere on this wiki), from MyTopDir we can do the following:</p>
<pre><code>git clone https://github.com/DUNE-DAQ/listrev.git
./build_daq_software.sh --install --pkgname listrev
</code></pre>
<p>...where here it's assumed you've already built and locally installed appfwk since it's a dependency of listrev. </p>
<p>If you want to see verbose output from the compiler, all you need to do is add the <code>--verbose</code> option:</p>
<pre><code>./build_daq_software.sh --verbose --pkgname &lt;package whose build you're troubleshooting&gt;
</code></pre>
<p>To check for deviations from the coding rules described in the <a href="https://github.com/DUNE-DAQ/styleguide/blob/develop/dune-daq-cppguide.md">DUNE C++ Style Guide</a>, run with the <code>--lint</code> option:</p>
<pre><code>./build_daq_software.sh --lint
</code></pre>
<p>...though be aware that some guideline violations (e.g., having a function which tries to do unrelated things) can't be picked up by the automated linter. </p>
<p>You can see all the options listed if you run the script with the <code>--help</code> command, i.e.</p>
<pre><code>./build_daq_software.sh --help
</code></pre>
<p>Finally, note that both the output of your builds and your unit tests are logged to files in the <code>./log</code> subdirectory. These files may have ASCII color codes which make them difficult to read with some tools; <code>more</code> or <code>cat</code>, however, will display the colors and not the codes themselves. </p>
</details>
<h2 id="running">Running</h2>
<p>In order to run the applications built during the above procedure, the system needs to be instructed on where to look for the libraries that can be used to instantiate objects. 
In order to do that, the environmental variable <code>CET_PLUGIN_PATH</code> has to contain the path to your compiled <code>src</code> and <code>test</code> sub-directories. This is handled by the <code>./setup_runtime_environment</code> script which was placed in MyTopDir when you ran quick-start.sh; all you need to do is source it:</p>
<pre><code>. ./setup_runtime_environment
</code></pre>
<p>Note that if you add a new repo to your development area, after building your new code you'll need to source the script again. </p>
<p>Once the runtime environment is set, just run the application you need.<br />
For example, from MyTopDir, you can run </p>
<pre><code class="language-bash">daq_application -c QueryResponseCommandFacility -j appfwk/test/producer_consumer_dynamic_test.json
</code></pre>
<p>This example accepts commands <em>configure</em>, <em>start</em>, <em>stop</em>, <em>unconfigure</em>, <em>quit</em>.</p>
<details><summary>daq_application Command Line Arguments</summary>

Use `daq_application --help` to see all of the possible options:

<pre><code>$ ./build/appfwk/apps/daq_application --help
./build/appfwk/apps/daq_application known arguments (additional arguments will be stored and passed on):
  -c [ --commandFacility ] arg CommandFacility plugin name
  -m [ --configManager ] arg   ConfigurationManager plugin name
  -s [ --service ] arg         Service plugin(s) to load
  -j [ --configJson ] arg      JSON Application configuration file name
  -h [ --help ]                produce help message
</code></pre>


</details>

<details><summary>Some additional information</summary>



### TRACE Messages

To enable the sending of TRACE messages to a memory buffer, you can set one of several TRACE environmental variables _before_ running `appfwk/apps/simple_test_app`.  One example is to use a command like `export TRACE_NAME=TRACE`.  (For more details, please see the [TRACE package documentation](https://cdcvs.fnal.gov/redmine/projects/trace/wiki/Wiki). For example, the [Circular Memory Buffer](https://cdcvs.fnal.gov/redmine/projects/trace/wiki/Circular_Memory_Buffer) section in the TRACE Quick Start talks about the env vars that you can use to enable tracing.)

To view the TRACE messages in the memory buffer, you can use the following additional steps:

* [if not done already] `export SPACK_ROOT=<your spack root> ; source $SPACK_ROOT/setup-env.sh`
* [if not done already] `spack load trace`
* `trace_cntl show` or `trace_cntl show | trace_delta -ct 1` (The latter displays the timestamps in human-readable format.  Note that the messages are listed in reverse chronological order in both cases.)

</details>

<h2 id="testing-and-running-inside-a-docker-container">Testing and running inside a docker container</h2>
<p>Requirements on the host machine:
* installation of cvmfs (instructions can be found <a href="https://wiki.dunescience.org/wiki/DUNE_Computing/Access_files_in_CVMFS#Installing_CVMFS_on_your_computer.28s.29">here</a>);
* installation of docker (instructions are available on its official website).</p>
<p>Docker image recommended to use is <a href="https://hub.docker.com/repository/docker/dingpf/artdaq">dingpf/artdaq:latest</a>. Its corresponding dockerfile can be found in <a href="https://github.com/dingp/artdaq-docker">this repo</a>.</p>
<p>Use <code>docker run --rm -it -v /cvmfs:/cvmfs -v $PWD:/scratch dingpf/artdaq</code> to start the container, where it mounts your local working directory as <code>/scratch</code> inside the container. You can then treat <code>/scratch</code> as the empty MyTopDir directory referred to in the instructions at the top of this page. </p>
<h2 id="next-steps">Next Steps</h2>
<ul>
<li>[[Creating a new package|Instructions-for-creating-a-new-package ]]</li>
<li>[[Step-by-step instructions for creating your own DAQModule package|Step-by-step-instructions-for-creating-your-own-DAQModule-package]]</li>
</ul></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../../js/base.js" defer></script>
        <script src="../../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
